# =============================================================================
# a2a_test/utilities/custom_logger.py
# ì»¤ìŠ¤í…€ ë¡œê·¸ ë ˆë²¨(A2A)ì„ ì¶”ê°€í•˜ê³ , ë¡œê·¸ ë ˆë²¨ í•„í„°ë§ ë° ìƒ‰ìƒ ì¶œë ¥ ê¸°ëŠ¥ì„ ì„¤ì •í•˜ëŠ” ëª¨ë“ˆ
# =============================================================================

import logging  # ê¸°ë³¸ ë¡œê¹… ê¸°ëŠ¥ì„ ì œê³µí•˜ëŠ” í‘œì¤€ ë¼ì´ë¸ŒëŸ¬ë¦¬
from colorlog import ColoredFormatter  # ë¡œê·¸ë¥¼ ì»¬ëŸ¬ë¡œ í¬ë§·í•˜ê¸° ìœ„í•œ ì™¸ë¶€ ë¼ì´ë¸ŒëŸ¬ë¦¬

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# ğŸ”¸ A2A ì „ìš© ì»¤ìŠ¤í…€ ë¡œê·¸ ë ˆë²¨ ì •ì˜
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

A2A_LEVEL = 25  # INFO(20)ì™€ WARNING(30) ì‚¬ì´ì˜ ì‚¬ìš©ì ì •ì˜ ë¡œê·¸ ë ˆë²¨
logging.addLevelName(A2A_LEVEL, "A2A")  # ìˆ«ì ë ˆë²¨ê³¼ ë¬¸ìì—´ ë ˆë²¨ëª…ì„ ì—°ê²°í•˜ì—¬ ë“±ë¡

def a2a_log(self, message, *args, **kwargs):
    """logger.a2a(...)ë¡œ A2A ë¡œê·¸ ê¸°ë¡ì„ ê°€ëŠ¥í•˜ê²Œ í•˜ëŠ” ì‚¬ìš©ì ì •ì˜ ë©”ì„œë“œ"""
    if self.isEnabledFor(A2A_LEVEL):  # í˜„ì¬ ë¡œê±°ê°€ A2A ë ˆë²¨ ì´ìƒì´ë©´
        self._log(A2A_LEVEL, message, args, **kwargs)  # ë¡œê·¸ë¥¼ A2A ë ˆë²¨ë¡œ ê¸°ë¡

# Logger í´ë˜ìŠ¤ì— a2a() ë©”ì„œë“œë¥¼ ë™ì ìœ¼ë¡œ ì¶”ê°€
logging.Logger.a2a = a2a_log

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# ğŸ”¸ ê¸°ë³¸ ë¡œê¹… ì„¤ì •
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

# ê¸°ë³¸ ë¡œê¹… ë ˆë²¨ì„ INFOë¡œ ì„¤ì •í•˜ì—¬, ê·¸ ì´ìƒ ë ˆë²¨ì˜ ë¡œê·¸ë§Œ ê¸°ë³¸ ì¶œë ¥
logging.basicConfig(level=logging.INFO)

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# ğŸ”¸ ë¡œê·¸ ì¶œë ¥ í¬ë§· ì •ì˜ (ì»¬ëŸ¬ í¬í•¨)
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

formatter = ColoredFormatter(
    fmt="%(log_color)s[%(levelname)s] %(name)s:%(reset)s \n%(message)s",  # ì¶œë ¥ í˜•ì‹ ì •ì˜
    log_colors={  # ê° ë¡œê·¸ ë ˆë²¨ë³„ ì»¬ëŸ¬ ì •ì˜
        "DEBUG":    "cyan",
        "INFO":     "green",
        "WARNING":  "yellow",
        "ERROR":    "red",
        "CRITICAL": "bold_red,bg_white",
        "A2A":      "bold_yellow",  # A2A ë ˆë²¨ì€ ê°•ì¡°ëœ ë…¸ë€ìƒ‰ìœ¼ë¡œ í‘œì‹œ
    }
)

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# ğŸ”¸ ë¡œê·¸ ë ˆë²¨ í•„í„° í´ë˜ìŠ¤ ì •ì˜
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

class LogLevelFilter(logging.Filter):
    """
    ì§€ì •ëœ ë¡œê·¸ ë ˆë²¨ë§Œ í†µê³¼ì‹œí‚¤ëŠ” í•„í„° í´ë˜ìŠ¤
    ì˜ˆ: "A2A"ë¡œ ì„¤ì • ì‹œ A2A ë ˆë²¨ì˜ ë¡œê·¸ë§Œ ì¶œë ¥ë¨
    """

    def __init__(self, target_level: str):
        super().__init__()
        self.target_level = target_level.upper()  # ëŒ€ë¬¸ìë¡œ ë³€í™˜í•˜ì—¬ ë¹„êµ

    def filter(self, record):
        """ë¡œê·¸ ë ˆë²¨ í•„í„°ë§ ë¡œì§"""
        if self.target_level == "ALL":
            return True  # ëª¨ë“  ë¡œê·¸ í—ˆìš©
        elif self.target_level == "A2A":
            return record.levelno == A2A_LEVEL  # A2Aë§Œ í—ˆìš©
        elif self.target_level in ["DEBUG", "INFO", "WARNING", "ERROR", "CRITICAL"]:
            target_level_num = getattr(logging, self.target_level)
            return record.levelno == target_level_num  # í•´ë‹¹ ë ˆë²¨ë§Œ í—ˆìš©
        return True  # ì˜ëª»ëœ ê°’ì´ ë“¤ì–´ì˜¤ë©´ ë¬´ì‹œí•˜ê³  ì „ì²´ ì¶œë ¥

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# ğŸ”¸ ì „ì—­ í•„í„° ì ìš© í•¨ìˆ˜
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

def configure_global_logging_filter(log_level: str):
    """
    ì „ì²´ ì• í”Œë¦¬ì¼€ì´ì…˜ ë‚´ ë¡œê¹… ì‹œìŠ¤í…œì— í•„í„°ë¥¼ ì „ì—­ ì ìš©
    í•¸ë“¤ëŸ¬ê°€ ë‹¬ë ¤ ìˆëŠ” ëª¨ë“  ë¡œê±°ì— í•„í„°ë¥¼ ì—°ê²°í•¨
    """
    if log_level.upper() == "ALL":
        return  # ALLì€ í•„í„°ë§ ì—†ì´ ì „ì²´ ì¶œë ¥í•˜ë¯€ë¡œ ë¬´ì‹œ

    log_filter = LogLevelFilter(log_level)  # ëŒ€ìƒ ë ˆë²¨ ê¸°ì¤€ì˜ í•„í„° ì¸ìŠ¤í„´ìŠ¤ ìƒì„±

    # ë£¨íŠ¸ ë¡œê±°ë¶€í„° ì‹œì‘í•´ í•¸ë“¤ëŸ¬ë§ˆë‹¤ í•„í„°ë¥¼ ì ìš©
    root_logger = logging.getLogger()
    for handler in root_logger.handlers:
        handler.addFilter(log_filter)

    # í˜„ì¬ê¹Œì§€ ë“±ë¡ëœ ëª¨ë“  ë¡œê±°ì— ëŒ€í•´ í•¸ë“¤ëŸ¬ì— í•„í„°ë¥¼ ì¶”ê°€
    for name in logging.Logger.manager.loggerDict:
        logger_obj = logging.getLogger(name)
        if logger_obj.handlers:
            for handler in logger_obj.handlers:
                handler.addFilter(log_filter)

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# ğŸ”¸ get_logger() í•¨ìˆ˜
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

def get_logger(name: str) -> logging.Logger:
    """
    ëª¨ë“ˆëª…(íŒŒì¼ëª…)ì„ ê¸°ë°˜ìœ¼ë¡œ í•œ ë¡œê±° ì¸ìŠ¤í„´ìŠ¤ë¥¼ ìƒì„±í•˜ê³  ì»¬ëŸ¬ í¬ë§·í„°ë¥¼ ì ìš©
    """
    logger = logging.getLogger(name)  # ëª¨ë“ˆ ì´ë¦„ ê¸°ë°˜ ë¡œê±° ìƒì„±
    logger.setLevel(logging.DEBUG)  # ëª¨ë“  ë ˆë²¨ í—ˆìš© (í•„í„°ëŠ” í•¸ë“¤ëŸ¬ì— ì ìš©í•¨)

    # ìƒˆë¡œìš´ í•¸ë“¤ëŸ¬ êµ¬ì„±
    handler = logging.StreamHandler()  # ì½˜ì†” ì¶œë ¥ìš© ìŠ¤íŠ¸ë¦¼ í•¸ë“¤ëŸ¬
    handler.setFormatter(formatter)    # ìœ„ì—ì„œ ì„¤ì •í•œ ì»¬ëŸ¬ í¬ë§·í„° ì ìš©

    # ê¸°ì¡´ í•¸ë“¤ëŸ¬ ì œê±° í›„ ìƒˆ í•¸ë“¤ëŸ¬ ì„¤ì •
    logger.handlers.clear()
    logger.addHandler(handler)
    logger.propagate = False  # ë¶€ëª¨ ë¡œê±°ë¡œ ë©”ì‹œì§€ ì „íŒŒ ì°¨ë‹¨ (ì¤‘ë³µ ì¶œë ¥ ë°©ì§€)

    return logger
